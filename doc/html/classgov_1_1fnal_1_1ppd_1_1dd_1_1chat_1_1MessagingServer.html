<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.5"/>
<title>Fermilab Dynamic Displays: gov.fnal.ppd.dd.chat.MessagingServer Class Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td style="padding-left: 0.5em;">
   <div id="projectname">Fermilab Dynamic Displays
   </div>
   <div id="projectbrief">Digital Signage System based on web browsers and Java</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.5 -->
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="namespaces.html"><span>Packages</span></a></li>
      <li class="current"><a href="annotated.html"><span>Classes</span></a></li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="annotated.html"><span>Class&#160;List</span></a></li>
      <li><a href="classes.html"><span>Class&#160;Index</span></a></li>
      <li><a href="hierarchy.html"><span>Class&#160;Hierarchy</span></a></li>
      <li><a href="functions.html"><span>Class&#160;Members</span></a></li>
    </ul>
  </div>
<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><b>gov</b></li><li class="navelem"><b>fnal</b></li><li class="navelem"><b>ppd</b></li><li class="navelem"><a class="el" href="namespacegov_1_1fnal_1_1ppd_1_1dd.html">dd</a></li><li class="navelem"><a class="el" href="namespacegov_1_1fnal_1_1ppd_1_1dd_1_1chat.html">chat</a></li><li class="navelem"><a class="el" href="classgov_1_1fnal_1_1ppd_1_1dd_1_1chat_1_1MessagingServer.html">MessagingServer</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="summary">
<a href="#nested-classes">Classes</a> &#124;
<a href="#pub-methods">Public Member Functions</a> &#124;
<a href="#pub-attribs">Public Attributes</a> &#124;
<a href="#pub-static-attribs">Static Public Attributes</a> &#124;
<a href="#pro-methods">Protected Member Functions</a> &#124;
<a href="#pro-attribs">Protected Attributes</a> &#124;
<a href="classgov_1_1fnal_1_1ppd_1_1dd_1_1chat_1_1MessagingServer-members.html">List of all members</a>  </div>
  <div class="headertitle">
<div class="title">gov.fnal.ppd.dd.chat.MessagingServer Class Reference</div>  </div>
</div><!--header-->
<div class="contents">

<p>Inherited by gov.fnal.ppd.dd.chat.MessagingServerDaemon.LocalMessagingServer, and gov.fnal.ppd.dd.chat.MessagingServerGUI.LocalMessagingServer.</p>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="pub-methods"></a>
Public Member Functions</h2></td></tr>
<tr class="memitem:a9b02c801edad834dcc2a0c96071900af"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classgov_1_1fnal_1_1ppd_1_1dd_1_1chat_1_1MessagingServer.html#a9b02c801edad834dcc2a0c96071900af">MessagingServer</a> (int port)</td></tr>
<tr class="separator:a9b02c801edad834dcc2a0c96071900af"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a69cf69b0f944a33ba7e1b9c32dd60ee6"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classgov_1_1fnal_1_1ppd_1_1dd_1_1chat_1_1MessagingServer.html#a69cf69b0f944a33ba7e1b9c32dd60ee6">start</a> ()</td></tr>
<tr class="separator:a69cf69b0f944a33ba7e1b9c32dd60ee6"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="pub-attribs"></a>
Public Attributes</h2></td></tr>
<tr class="memitem:ae9c73322e842357c87634a60426e5bf0"><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="ae9c73322e842357c87634a60426e5bf0"></a>
int&#160;</td><td class="memItemRight" valign="bottom"><b>numRemovedBadWriteSeen</b> = 0</td></tr>
<tr class="separator:ae9c73322e842357c87634a60426e5bf0"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a3fe04e43605b1c81c063cf9d334fb763"><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="a3fe04e43605b1c81c063cf9d334fb763"></a>
int&#160;</td><td class="memItemRight" valign="bottom"><b>numRemovedNullClientThread</b> = 0</td></tr>
<tr class="separator:a3fe04e43605b1c81c063cf9d334fb763"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a84d7bc143f1eee20c7e39ce9024783c9"><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="a84d7bc143f1eee20c7e39ce9024783c9"></a>
int&#160;</td><td class="memItemRight" valign="bottom"><b>numRemovedNullUsername</b> = 0</td></tr>
<tr class="separator:a84d7bc143f1eee20c7e39ce9024783c9"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ab986fa29bcdc51bd186ad23e1c699426"><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="ab986fa29bcdc51bd186ad23e1c699426"></a>
int&#160;</td><td class="memItemRight" valign="bottom"><b>numRemovedNullDate</b> = 0</td></tr>
<tr class="separator:ab986fa29bcdc51bd186ad23e1c699426"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a189ff6081d21eb1a9c98887d84e23b17"><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="a189ff6081d21eb1a9c98887d84e23b17"></a>
int&#160;</td><td class="memItemRight" valign="bottom"><b>numRemovedExitedForeverLoop</b> = 0</td></tr>
<tr class="separator:a189ff6081d21eb1a9c98887d84e23b17"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="pub-static-attribs"></a>
Static Public Attributes</h2></td></tr>
<tr class="memitem:a738da0a18944421491268d2220a3c7a4"><td class="memItemLeft" align="right" valign="top">static final String&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classgov_1_1fnal_1_1ppd_1_1dd_1_1chat_1_1MessagingServer.html#a738da0a18944421491268d2220a3c7a4">SPECIAL_SERVER_MESSAGE_USERNAME</a> = &quot;Server Message&quot;</td></tr>
<tr class="separator:a738da0a18944421491268d2220a3c7a4"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="pro-methods"></a>
Protected Member Functions</h2></td></tr>
<tr class="memitem:ae45eb53ec2614d072c92a7f6615cae75"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classgov_1_1fnal_1_1ppd_1_1dd_1_1chat_1_1MessagingServer.html#ae45eb53ec2614d072c92a7f6615cae75">broadcast</a> (<a class="el" href="classgov_1_1fnal_1_1ppd_1_1dd_1_1chat_1_1MessageCarrier.html">MessageCarrier</a> mc)</td></tr>
<tr class="separator:ae45eb53ec2614d072c92a7f6615cae75"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a658cba9627ce15a7075010447eb0ad57"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classgov_1_1fnal_1_1ppd_1_1dd_1_1chat_1_1MessagingServer.html#a658cba9627ce15a7075010447eb0ad57">broadcast</a> (SignedObject message)</td></tr>
<tr class="separator:a658cba9627ce15a7075010447eb0ad57"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:afe655a915ee116333ee6f1c8331b7929"><td class="memItemLeft" align="right" valign="top">String&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classgov_1_1fnal_1_1ppd_1_1dd_1_1chat_1_1MessagingServer.html#afe655a915ee116333ee6f1c8331b7929">exceptionString</a> (Exception e)</td></tr>
<tr class="separator:afe655a915ee116333ee6f1c8331b7929"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:af24f72f6ce9d270c33afb4032d9c968b"><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="af24f72f6ce9d270c33afb4032d9c968b"></a>
void&#160;</td><td class="memItemRight" valign="bottom"><b>performDiagnostics</b> (boolean show)</td></tr>
<tr class="separator:af24f72f6ce9d270c33afb4032d9c968b"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a90da887bb782b08af3fb1dbce8c3e502"><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="a90da887bb782b08af3fb1dbce8c3e502"></a>
void&#160;</td><td class="memItemRight" valign="bottom"><b>showAllClientsConnectedNow</b> ()</td></tr>
<tr class="separator:a90da887bb782b08af3fb1dbce8c3e502"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a2ab9736895b528ec810dd27eb5761295"><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="a2ab9736895b528ec810dd27eb5761295"></a>
void&#160;</td><td class="memItemRight" valign="bottom"><b>stop</b> ()</td></tr>
<tr class="separator:a2ab9736895b528ec810dd27eb5761295"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="pro-attribs"></a>
Protected Attributes</h2></td></tr>
<tr class="memitem:ac727c375b30722fb0d0a88f27eb97954"><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="ac727c375b30722fb0d0a88f27eb97954"></a>
SimpleDateFormat&#160;</td><td class="memItemRight" valign="bottom"><b>sdf</b></td></tr>
<tr class="separator:ac727c375b30722fb0d0a88f27eb97954"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a6847562b2441991b550f7b3cb7fe8f2d"><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="a6847562b2441991b550f7b3cb7fe8f2d"></a>
int&#160;</td><td class="memItemRight" valign="bottom"><b>totalMesssagesHandled</b> = 0</td></tr>
<tr class="separator:a6847562b2441991b550f7b3cb7fe8f2d"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a723da061c3ef4f584162110653adcbe2"><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="a723da061c3ef4f584162110653adcbe2"></a>
Logger&#160;</td><td class="memItemRight" valign="bottom"><b>logger</b></td></tr>
<tr class="separator:a723da061c3ef4f584162110653adcbe2"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><p>The server that can be run both as a console application or a GUI</p>
<p>TODO: Improve the architecture</p>
<p>According to <a href="http://docs.oracle.com/cd/E19957-01/816-6024-10/apa.htm">http://docs.oracle.com/cd/E19957-01/816-6024-10/apa.htm</a> (the first hit on Google for "Messaging Server Architecture" ), a well-built messaging server has these six components: </p>
<ul>
<li>
The dispatcher is the daemon (or service) component of the Messaging Server. It coordinates the activities of all other modules. In Figure A.1, the dispatcher can be thought of as an envelope that contains and initiates the processes of all items shown within the largest box. </li>
<li>
The module configuration database contains general configuration information for the other modules. </li>
<li>
The message transfer agent (MTA) handles all message accepting, routing, and delivery tasks. </li>
<li>
The Messaging Server managers facilitate remote configuration and operation of the system and ensure that the modules are doing their job and following the rules. </li>
<li>
The AutoReply utility lets the Messaging Server automatically reply to incoming messages with predefined responses of your choice. </li>
<li>
The directory database&ndash;either a local directory database or a Directory Server&ndash;contains user and group account information for the other modules. </li>
</ul>
<p>In this application of the idea, I have pretty much a stove-pipe server with only one bit of a protocol, handled elsewhere. The message is an object (see MessageCarrier.java) with four attributes: </p>
<ul>
<li>
<a class="el" href="enumgov_1_1fnal_1_1ppd_1_1dd_1_1chat_1_1MessageType.html">MessageType</a> type; &ndash; An enum of the sorts of messages we expect </li>
<li>
String message; &ndash; The message body (if it is required). in principle, this can be encrypted (and then ASCII-fied). In this architecture, when the message is used, it is usually an XML document </li>
<li>
String to; &ndash; The name of the client who is supposed to get this message. <em>This could be changed to a <em>"subscription topic."</em> </em></li>
<li>
<em>String from; &ndash; The name of the client who sent the message (allowing a reply of some sort) </em></li>
</ul>
<p><em></em></p>
<p><em></em></p>
<p><em> It may be possible to use ObjectOutputStream and ObjectInputStream to send the EncodedCarrier (XML) object directly, without the existing XML marshalling and unmarshalling. But since this works, I have little motivation to make this change. Future developers may be more enthusiastic to do this. The existing scheme makes it easy to add on encryption of the message (which is the XML document), which would allow the routing of the message without decrypting. </em></p>
<p><em></em></p>
<p><em></em></p>
<p><em> What about encryption? If we ever need to secure this communication, it should be possible to encrypt parts of the message. A simple way to implement this would be to add a time stamp to <a class="el" href="classgov_1_1fnal_1_1ppd_1_1dd_1_1chat_1_1MessageCarrier.html">MessageCarrier</a> which is encrypted and re-ASCII-fied. Using an asymmetric encryption, the source (the <a class="el" href="classgov_1_1fnal_1_1ppd_1_1dd_1_1ChannelSelector.html">ChannelSelector</a>) can encrypt it with its secret key and then the destination (the Display) can decrypt it with the public key and then verify that the date is "recent". Or one can encrypt the XML document itself (which includes a time stamp). This will probably not be necessary at Fermilab as it is hard to imagine a situation where someone would put bad stuff into the stream of messages and foul things up. But hackers are a clever bunch, so never say never. </em></p>
<p><em> </em></p>
<p><em> We have opted not to encrypt these messages, but rather to cryptographically sign them. </em></p>
<p><em> </em></p>
<p><em> An operational observation: A Client often drop out without saying goodbye. Almost always when this happens, the socket connection between the server and the client gets corrupted and the server notices. When it does notice, it can delete this client from its inventory. But sometimes this corruption does not happen and the socket somehow remains viable from the server's perspective. In this situation, when the Client tries to reconnect it is turned away as its name is already in use. Thus, I have implemented a heart beat from the server to each client to see if this client really is alive. See startPinger() method for details. </em></p>
<p><em></em></p>
<p><em></p>
<dl class="section author"><dt>Author</dt><dd>Elliott McCrory, Fermilab AD/Instrumentation </dd></dl>
<p></em></p>
</div><h2 class="groupheader">Constructor &amp; Destructor Documentation</h2>
<a class="anchor" id="a9b02c801edad834dcc2a0c96071900af"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">gov.fnal.ppd.dd.chat.MessagingServer.MessagingServer </td>
          <td>(</td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>port</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>server constructor that receive the port to listen to for connection as parameter in console</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">port</td><td></td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<h2 class="groupheader">Member Function Documentation</h2>
<a class="anchor" id="ae45eb53ec2614d072c92a7f6615cae75"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">void gov.fnal.ppd.dd.chat.MessagingServer.broadcast </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="classgov_1_1fnal_1_1ppd_1_1dd_1_1chat_1_1MessageCarrier.html">MessageCarrier</a>&#160;</td>
          <td class="paramname"><em>mc</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">protected</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<p>Broadcast an unsigned message to a Client</p>
<p>Overrideable if the base class wants to know about the messages.</p>
<p>Be sure to call super.broadcast(message) to actually get the message broadcast, though!</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">mc</td><td>The message to broadcast </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a class="anchor" id="a658cba9627ce15a7075010447eb0ad57"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">void gov.fnal.ppd.dd.chat.MessagingServer.broadcast </td>
          <td>(</td>
          <td class="paramtype">SignedObject&#160;</td>
          <td class="paramname"><em>message</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">protected</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<p>Broadcast a signed message to a Client</p>
<p>Overrideable if the base class wants to know about the messages.</p>
<p>Be sure to call super.broadcast(message) to actually get the message broadcast, though!</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">message</td><td>&ndash; The message to broadcast </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a class="anchor" id="afe655a915ee116333ee6f1c8331b7929"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">String gov.fnal.ppd.dd.chat.MessagingServer.exceptionString </td>
          <td>(</td>
          <td class="paramtype">Exception&#160;</td>
          <td class="paramname"><em>e</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">protected</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<p>Display a message to the console or the GUI </p>

</div>
</div>
<a class="anchor" id="a69cf69b0f944a33ba7e1b9c32dd60ee6"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void gov.fnal.ppd.dd.chat.MessagingServer.start </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Start the messaging server </p>

</div>
</div>
<h2 class="groupheader">Member Data Documentation</h2>
<a class="anchor" id="a738da0a18944421491268d2220a3c7a4"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">final String gov.fnal.ppd.dd.chat.MessagingServer.SPECIAL_SERVER_MESSAGE_USERNAME = &quot;Server Message&quot;</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<p>The name we use for the messaging server, when it is sending a message out </p>

</div>
</div>
<hr/>The documentation for this class was generated from the following file:<ul>
<li>src/gov/fnal/ppd/dd/chat/MessagingServer.java</li>
</ul>
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.5
</small></address>
</body>
</html>
